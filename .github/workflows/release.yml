name: Build and Release

on:
  push:
    tags:
      - 'v*'
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v3
    
    - name: Build extension package
      run: |
        # åˆ›å»ºä¸´æ—¶ç›®å½•
        mkdir -p build
        
        # å¤åˆ¶éœ€è¦çš„æ–‡ä»¶
        cp package.json build/
        cp zh-hans.ini build/
        cp README.md build/
        
        # æ‰“åŒ…ä¸º zip
        cd build
        zip -r ../aseprite-chinese.aseprite-extension package.json zh-hans.ini README.md
        cd ..
        
        # æ˜¾ç¤ºæ–‡ä»¶ä¿¡æ¯
        ls -lh aseprite-chinese.aseprite-extension
    
    - name: Upload artifact
      uses: actions/upload-artifact@v3
      with:
        name: aseprite-chinese-extension
        path: aseprite-chinese.aseprite-extension
    
    - name: Create Release
      if: startsWith(github.ref, 'refs/tags/')
      uses: softprops/action-gh-release@v1
      with:
        files: aseprite-chinese.aseprite-extension
        body: |
          # Aseprite ç®€ä½“ä¸­æ–‡è¯­è¨€åŒ… ${{ github.ref_name }}
          
          ## ğŸ‰ ç‰¹æ€§
          
          - âœ… 100% å®Œæ•´ç¿»è¯‘ï¼ˆ2081 è¡Œï¼‰
          - âœ… è¦†ç›–æ‰€æœ‰ç•Œé¢å…ƒç´ 
          - âœ… æ— è‹±æ–‡æ®‹ç•™
          
          ## ğŸ“¦ å®‰è£…æ–¹æ³•
          
          1. ä¸‹è½½ `aseprite-chinese.aseprite-extension`
          2. åœ¨ Aseprite ä¸­ï¼š`Edit > Preferences > Extensions > Add Extension`
          3. é€‰æ‹©ä¸‹è½½çš„æ–‡ä»¶
          4. é‡å¯ Aseprite
          5. `Edit > Preferences > General > Language > ç®€ä½“ä¸­æ–‡`
          6. å†æ¬¡é‡å¯
          
          ## ğŸ“ æ›´æ–°å†…å®¹
          
          æŸ¥çœ‹ [README.md](https://github.com/sc3531486/aseprite-chinese/blob/main/README.md) äº†è§£è¯¦æƒ…ã€‚
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
